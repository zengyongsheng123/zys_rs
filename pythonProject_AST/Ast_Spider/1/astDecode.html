
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>AST在线测试</title>
        <script src="babel_ast.js"></script>
    </head>
    <body>
    <script>
        const sourceCode = `let a = 1 + 2;`;
        let ast = parser.parse(sourceCode);
        const constantFold = {
    "Identifier|BinaryExpression|UnaryExpression|ConditionalExpression"(path) {
        if (path.isUnaryExpression({ operator: "-" }) ||
            path.isUnaryExpression({ operator: "void" })) {
            return;
        }
        let { confident, value } = path.evaluate();
        if (!confident) return; //无法计算出结果，直接返回
        let valueType = typeof value;
        if (!["number", "string", "boolean"].includes(valueType)) {
            return;
        }
        if (valueType === 'number' && (!Number.isFinite(value))) { //过滤掉 1/0 这种情况，否则会导致堆栈溢出。
            return;
        }
        path.replaceWith(types.valueToNode(value))

    }
}
        traverse(ast, constantFold);

        function download(text, name) {
            var a = document.createElement("a");
            var file = new Blob([text], {type: "text/javascript"});
            a.href = URL.createObjectURL(file);
            var now = new Date();
            var month = now.getMonth();//得到月份
            var date = now.getDate();//得到日期
            month = month.toString().padStart(2,0);
            date  = date.toString().padStart(2,0);
            a.download = "decodeResult" + month + date + '.js';
            a.click();
            a.remove();
       }

    let {code} = generator(ast);

    download(code);
</script>
    </body>

</html>